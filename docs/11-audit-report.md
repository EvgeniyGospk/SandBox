# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç Particula (—Ñ–æ–∫—É—Å: —Ñ–∏–∑–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏)

## üìä Executive Summary
–ü—Ä–æ–µ–∫—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ —Å–∏–ª—å–Ω—ã–π (Rust/WASM + Worker + chunk/dirty-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏), –Ω–æ **—è–¥—Ä–æ —Ñ–∏–∑–∏–∫–∏ —Å–µ–π—á–∞—Å –∏–º–µ–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏**, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–æ—è–≤–ª—è—Ç—å—Å—è –∫–∞–∫ –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º, ‚Äú–¥—ë—Ä–≥–∞–Ω–∞—è‚Äù –¥–∏–Ω–∞–º–∏–∫–∞ –∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–∏–∑–∏–∏. –û—Ç–¥–µ–ª—å–Ω–æ: –º–æ–¥–µ–ª—å ‚Äúdirty-chunks-only‚Äù –¥–ª—è behavior-pass —Ä–∏—Å–∫—É–µ—Ç **–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å lifetime/—Ä–µ–∞–∫—Ü–∏–∏** –≤ —Å–ø–æ–∫–æ–π–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ö, —á—Ç–æ –ª–æ–º–∞–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç –ø–µ—Å–æ—á–Ω–∏—Ü—ã.

**Overall Weighted Score:** **71/100** *(–≤–µ—Å–∞: domain-–º–µ—Ç—Ä–∏–∫–∏ 50%, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ 50% ‚Äî —Ç.–∫. —Ñ–∏–∑–∏–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç—å—é –ø—Ä–æ–µ–∫—Ç–∞)*

---

## üéØ Detailed Metrics Analysis

### 1. Architecture & SOLID: **78/100**
- **Reasoning:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤ —Ü–µ–ª–æ–º –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è: `Grid` (SoA), `ChunkGrid` (–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è), `World` –∫–∞–∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä, –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (`behaviors/*`), –æ—Ç–¥–µ–ª—å–Ω–∞—è ‚ÄúPhase 2‚Äù —Ñ–∏–∑–∏–∫–∞ (`physics.rs`). –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ ‚Äî –≤–Ω—è—Ç–Ω—ã–π runtime —Å–ª–æ–π (WorkerBridge/SimulationController).
- **Critical Issues:**
  - ‚Äú2D gravity API‚Äù —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω: `World::set_gravity(x,y)` —Ö—Ä–∞–Ω–∏—Ç `gravity_x`, –Ω–æ particle-physics –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `gravity_y` (`SandBox/packages/engine/src/world.rs:366`, `SandBox/packages/engine/src/physics.rs:360`), –∞ `PowderBehavior` —Å—á–∏—Ç–∞–µ—Ç `gx`, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç (`SandBox/packages/engine/src/behaviors/powder.rs:64`).
  - RigidBodies –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ API –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ **stub/no-op** (`SandBox/packages/engine/src/rigid_body_system.rs:1`, `SandBox/apps/web/src/workers/simulation.worker.ts:1032`).
- **Action Plan:**
  1. –õ–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏ –≤ physics-pass, –ª–∏–±–æ ‚Äú—É—Ä–µ–∑–∞—Ç—å‚Äù API –¥–æ `gravityY` –∏ —É–¥–∞–ª–∏—Ç—å `gravity_x` –∏–∑ –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.
  2. –Ø–≤–Ω–æ feature-flag‚Äô–Ω—É—Ç—å rigid bodies (–∏ –≤ UI/worker –ø—Ä–æ—Ç–æ–∫–æ–ª–µ), –ª–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ‚Äú–º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á—É—é‚Äù –≤–µ—Ä—Å–∏—é (–±–µ–∑ ‚Äú—Ç–∏—Ö–æ–≥–æ —É—Å–ø–µ—Ö–∞‚Äù).

### 2. Code Quality & Clean Code: **74/100**
- **Reasoning:** –ö–æ–¥ —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ —è–≤–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (unsafe + –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Äú–ø–æ—á–µ–º—É –º–æ–∂–Ω–æ‚Äù). –ù–æ –µ—Å—Ç—å ‚Äú—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω—ã‚Äù –∏ –ø–æ—Ä–æ–≥–∏/–º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ —Ñ–∏–∑–∏–∫–µ.
- **Critical Issues:**
  - –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ `friction`: –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞—ë—Ç `solid.friction = 0.0` –∫–∞–∫ ‚Äústatic‚Äù, –∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ props —Ç—Ä–∞–∫—Ç—É–µ—Ç 0.0 –∫–∞–∫ ‚Äúinstant stop‚Äù; –≤ physics‚Äô–µ 0.0 –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ 1.0 (`SandBox/packages/engine/src/physics.rs:364`, `SandBox/scripts/generate-elements.js:43`).
  - –î–µ—Ç–µ–∫—Ç–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–ª–∏–∑–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `vy.abs() as i32` / `vx.abs() as i32`, —á—Ç–æ –ª–æ–º–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç—è—Ö < 1.0 –∏ –¥–∞—ë—Ç ‚Äú–∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—é‚Äù –æ—Ç–≤–µ—Ç–∞ (`SandBox/packages/engine/src/physics.rs:287`, `SandBox/packages/engine/src/physics.rs:294`).
- **Action Plan:**
  1. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã/—Å–µ–º–∞–Ω—Ç–∏–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (JSON schema + –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä + engine).
  2. –£–±—Ä–∞—Ç—å `as i32` –∏–∑ –ª–æ–≥–∏–∫–∏ –∫–æ–ª–ª–∏–∑–∏–π; –Ω–æ—Ä–º–∞–ª—å —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã—á–∏—Å–ª—è—Ç—å—Å—è —è–≤–Ω–æ.
  3. –í—ã–Ω–µ—Å—Ç–∏ –ø–æ—Ä–æ–≥–∏ (`0.01`, `0.1`, `MAX_RAYCAST_STEPS`) –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —É—Ä–æ–≤–Ω—è –º–æ–¥—É–ª—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤.

### 3. Security & Data Integrity: **86/100**
- **Reasoning:** –†–∏—Å–∫ OWASP –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–∞ –Ω–µ–≤—ã—Å–æ–∫ (–Ω–µ—Ç —è–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º HTML/SQL). –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏ —Ç—É—Ç ‚Äî —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å–∏–º—É–ª—è—Ü–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å unsafe-–ø—É—Ç–µ–π.
- **Critical Issues:**
  - `MoveBuffer` **—Ç–∏—Ö–æ –¥—Ä–æ–ø–∞–µ—Ç** –¥–≤–∏–∂–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ (`SandBox/packages/engine/src/grid.rs:43`), —á—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å chunk-—Ç—Ä–µ–∫–∏–Ω–≥/—Ä–µ–Ω–¥–µ—Ä-–≥—Ä—è–∑—å –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ ‚Äú–Ω–µ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º‚Äù –∑–∞–ª–∏–ø–∞–Ω–∏—è–º.
- **Action Plan:**
  1. –ü—Ä–∏ overflow: –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –≤ ‚Äúdegraded mode‚Äù (—Ñ–æ—Ä—Å full-rescan/dirty-all –¥–ª—è chunk-—Å–∏—Å—Ç–µ–º—ã), –∞ –Ω–µ –º–æ–ª—á–∞ —Ç–µ—Ä—è—Ç—å —Å–æ–±—ã—Ç–∏—è.
  2. –í–∫–ª—é—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É overflow –≤ UI (—É–∂–µ –µ—Å—Ç—å —Å—á—ë—Ç—á–∏–∫), —á—Ç–æ–±—ã –ª–æ–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ö.

### 4. Performance & Efficiency: **80/100**
- **Reasoning:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∏–ª—å–Ω—ã–µ: SoA, chunking, offscreen worker, dirty-rect batching, optional Rayon. –ù–æ —Ñ–∏–∑–∏–∫–∞ —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ—Ä–æ–≥–∏—Ö –≤–µ—â–µ–π ‚Äú–≤ –ª–æ–±‚Äù.
- **Critical Issues:**
  - –í physics-pass –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `grid.swap(...)`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç **–∫–∞–∂–¥–æ–µ** –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ `pending_moves` (`SandBox/packages/engine/src/physics.rs:393`, `SandBox/packages/engine/src/grid.rs:294`). –≠—Ç–æ –æ–±–Ω—É–ª—è–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é ‚Äúrecord only cross-chunk moves‚Äù –∏–∑ `swap_unchecked` (`SandBox/packages/engine/src/grid.rs:534`) –∏ –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ overflow (`SandBox/packages/engine/src/grid.rs:43`).
  - physics-pass –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º —á–∞–Ω–∫–∞–º —Å –¥–∞–Ω–Ω—ã–º–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç ‚Äúdirty‚Äù (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç behavior-pass) (`SandBox/packages/engine/src/world.rs:742`).
- **Action Plan:**
  1. –î–ª—è physics-pass –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äúsmart swap‚Äù (–±–µ–∑ –∑–∞–ø–∏—Å–∏ intra-chunk move) ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±—ë—Ä—Ç–æ—á–Ω—ã–π –º–µ—Ç–æ–¥ –∏–ª–∏ `swap_unchecked` –ø—Ä–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö bounds.
  2. –î–æ–±–∞–≤–∏—Ç—å cheap-—É—Å–ª–æ–≤–∏–µ ‚Äú–µ—Å—Ç—å –ª–∏ –Ω–µ–Ω—É–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –≤ —á–∞–Ω–∫–µ‚Äù (–≥—Ä—É–±–∞—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞), —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é ‚Äú—É—Å–Ω—É–≤—à—É—é‚Äù –∫–∏–Ω–µ–º–∞—Ç–∏–∫—É.

### 5. Extensibility & Maintainability: **70/100**
- **Reasoning:** –†–∞—Å—à–∏—Ä—è—Ç—å –Ω–∞–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–¥–æ–±–Ω–æ (SSOT JSON + codegen). –ù–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ–∏–∑–∏–∫—É/–º–∞—Ç–µ—Ä–∏–∞–ª-–º–æ–¥–µ–ª—å —Å–ª–æ–∂–Ω–µ–µ: –º–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ—Ö–æ–¥–∞, updated-—Ñ–ª–∞–≥–∏, –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ physics vs behaviors).
- **Critical Issues:**
  - –†–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äú—Ç–æ–ª—å–∫–æ dirty chunks‚Äù –¥–ª—è behavior-pass –º–æ–∂–µ—Ç –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å –≤–∞–∂–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (lifetime, —Ä–µ–∞–∫—Ü–∏–∏) –≤ —Å–ø–æ–∫–æ–π–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ö (`SandBox/packages/engine/src/world.rs:1122`, `SandBox/packages/engine/src/world.rs:1234`, `SandBox/packages/engine/src/chunks.rs:184`).
- **Action Plan:**
  1. –†–∞–∑–¥–µ–ª–∏—Ç—å ‚Äúrender dirty‚Äù –∏ ‚Äúsimulation active‚Äù: —á–∞–Ω–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ dirty –ø–æ —Ä–µ–Ω–¥–µ—Ä—É, –Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚Äúactive‚Äù –¥–ª—è lifetime/reactions.
  2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è —Ñ–∏–∑–∏–∫–∏ (—Å–º. remediation plan).

### 6. Error Handling & Resilience: **78/100**
- **Reasoning:** Worker loop —Ö–æ—Ä–æ—à–æ –∑–∞—â–∏—â—ë–Ω (try/catch –≤–æ–∫—Ä—É–≥ `world.step`, clamping dt, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ backlog) (`SandBox/apps/web/src/workers/simulation.worker.ts:363`). –ï—Å—Ç—å MemoryManager –¥–ª—è –¥–µ—Ç–µ–∫—Ç–∞ —Ä–æ—Å—Ç–∞ WASM –ø–∞–º—è—Ç–∏.
- **Critical Issues:**
  - RigidBody API –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ worker, –Ω–æ –¥–≤–∏–∂–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ‚Äú–ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç‚Äù (no-op) –±–µ–∑ —Å–∏–≥–Ω–∞–ª–∞ –æ—à–∏–±–∫–∏ (`SandBox/packages/engine/src/rigid_body_system.rs:26`, `SandBox/apps/web/src/workers/simulation.worker.ts:1032`).
- **Action Plan:**
  1. –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —è–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å/–æ—à–∏–±–∫—É –¥–ª—è disabled –ø–æ–¥—Å–∏—Å—Ç–µ–º, —á—Ç–æ–±—ã UI –º–æ–≥ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å ‚Äúfeature disabled‚Äù.
  2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å fallback, –µ—Å–ª–∏ `requestAnimationFrame` –≤ worker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Ç–∞–π–º–µ—Ä), —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é –Ω–∞ —á–∞—Å—Ç–∏ –æ–∫—Ä—É–∂–µ–Ω–∏–π.

### 7. Design Patterns: **82/100**
- **Reasoning:** –•–æ—Ä–æ—à–∏–π data-oriented –ø–æ–¥—Ö–æ–¥ –≤ engine, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞—Å–∞–¥—ã –∏ bridge –≤ web (`SimulationController`, `WorkerBridge`). –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚Äúpass-based‚Äù (physics ‚Üí behaviors ‚Üí temperature) —á–∏—Ç–∞–µ–º–∞.
- **Critical Issues:**
  - ‚ÄúStub –≤ –ø—Ä–æ–¥–∞–∫—à–Ω-API‚Äù (RigidBodySystem) ‚Äî –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω: –∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—ä—è–≤–ª–µ–Ω, –Ω–æ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.
- **Action Plan:**
  1. –î–æ–≤–µ—Å—Ç–∏ feature –¥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—á–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ —É–±—Ä–∞—Ç—å –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø—É—Ç–∏.

---

### 8. Domain-Specific Analysis (Auto-Detected)

**Metric A: –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ—Å—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∞–ø–¥–µ–π—Ç–∞** ‚Äî **45/100**
- *Issue:* physics-pass –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `updated`-—Ñ–ª–∞–≥ –∏ –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ—Ö–æ–¥–∞ (`SandBox/packages/engine/src/physics.rs:312`), –Ω–æ –ø—Ä–æ—Ö–æ–¥ –ø–æ X –≤—Å–µ–≥–¥–∞ —Å–ª–µ–≤–∞-–Ω–∞–ø—Ä–∞–≤–æ (`SandBox/packages/engine/src/world.rs:771`, `SandBox/packages/engine/src/world.rs:793`). –ü—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏/–æ—Ç—Å–∫–æ–∫–∞—Ö —á–∞—Å—Ç–∏—Ü—ã –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞ –æ–¥–∏–Ω —à–∞–≥ ‚Üí –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏ ‚Äú—É—Å–∫–æ—Ä–µ–Ω–∏–µ‚Äù –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–∏—Ü.
- *Fix:* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `updated` (–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π `physics_updated`) –≤–æ –≤—Ä–µ–º—è physics-pass, –∑–∞—Ç–µ–º —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –ø–µ—Ä–µ–¥ behavior-pass (–∏–ª–∏ –∏–º–µ—Ç—å 2 –Ω–∞–±–æ—Ä–∞ —Ñ–ª–∞–≥–æ–≤).

**Metric B: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–ª–ª–∏–∑–∏–π –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤** ‚Äî **55/100**
- *Issue:* –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å `vx/vy` –ø–æ—Å–ª–µ `as i32`, —á—Ç–æ –ª–æ–º–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø—Ä–∏ –º–∞–ª—ã—Ö —Å–∫–æ—Ä–æ—Å—Ç—è—Ö (`SandBox/packages/engine/src/physics.rs:287`, `SandBox/packages/engine/src/physics.rs:294`). –¢–∞–∫–∂–µ physics-pass –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–º ‚Äú–Ω–µ –ø—É—Å—Ç–æ–º‚Äù —ç–ª–µ–º–µ–Ω—Ç–µ, –±–µ–∑ —É—á—ë—Ç–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –ø–æ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ (–≤–∞–∂–Ω–æ –¥–ª—è –ø–µ—Å–æ—á–Ω–∏—Ü—ã).
- *Fix:* –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–∑ raycast —è–≤–Ω—É—é ‚Äú–Ω–æ—Ä–º–∞–ª—å‚Äù/–ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É; –≤–Ω–µ–¥—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ ‚Äú–ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç–∏/–≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è‚Äù –¥–ª—è –ø–∞—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π (powder‚Üîliquid‚Üîgas) –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —á–∞—Å—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –≤ behaviors.

**Metric C: –¢–∞–π–º–∏–Ω–≥ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç FPS** ‚Äî **88/100**
- *Issue & Fix:* Worker –¥–µ–ª–∞–µ—Ç fixed-step —á–µ—Ä–µ–∑ accumulator –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç backlog (`SandBox/apps/web/src/workers/simulation.worker.ts:368`). –≠—Ç–æ —Å–∏–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã. –£–ª—É—á—à–µ–Ω–∏–µ ‚Äî fallback-–ø–ª–∞–Ω –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏–π –±–µ–∑ rAF –≤ worker –∏ –±–æ–ª–µ–µ —è–≤–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ `speed` (time-warp).

---

## üí° Priority Remediation Plan

1. **[Critical] –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ—Å—Ç—å physics-step –¥–ª—è —á–∞—Å—Ç–∏—Ü—ã** ‚Äî –≤–Ω–µ–¥—Ä–∏—Ç—å `updated/physics_updated` –≤ physics-pass (–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç double-processing) (`SandBox/packages/engine/src/physics.rs:312`, `SandBox/packages/engine/src/world.rs:771`).
2. **[Critical] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–∏–∑–∏–∏ (–¥–µ—Ç–µ–∫—Ç–æ—Ä –æ—Å–∏/–Ω–æ—Ä–º–∞–ª–∏)** ‚Äî —É–±—Ä–∞—Ç—å `as i32`, –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å/–∫–ª–µ—Ç–∫—É —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –∏–∑ raycast –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å (`SandBox/packages/engine/src/physics.rs:287`).
3. **[Critical] –ú–∞—Ç–µ—Ä–∏–∞–ª-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å ‚Äú–≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –ø–æ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏‚Äù –≤ physics-pass –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π swap –≤ `PowderBehavior/LiquidBehavior` (–∏–Ω–∞—á–µ –ø–µ—Å–æ–∫/–∂–∏–¥–∫–æ—Å—Ç–∏ –≤–µ–¥—É—Ç —Å–µ–±—è –Ω–µ –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—Ç sandbox).
4. **[Critical] Behavior-pass –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç dirty** ‚Äî –∏–Ω–∞—á–µ lifetime/—Ä–µ–∞–∫—Ü–∏–∏ ‚Äú–∑–∞–º–µ—Ä–∑–∞—é—Ç‚Äù –ø—Ä–∏ —Å–ø–æ–∫–æ–π–Ω–æ–π —Å—Ü–µ–Ω–µ (`SandBox/packages/engine/src/world.rs:1122`, `SandBox/packages/engine/src/chunks.rs:184`, `SandBox/packages/engine/src/world.rs:1234`).
5. **[High] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é** ‚Äî –ª–∏–±–æ —Ä–µ–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å `gravity_x`, –ª–∏–±–æ —É–±—Ä–∞—Ç—å –∏–∑ API –∏ UI/worker —Å–æ–æ–±—â–µ–Ω–∏–π (—Å–µ–π—á–∞—Å —ç—Ç–æ ‚Äú–ª–æ–∂–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç‚Äù) (`SandBox/packages/engine/src/world.rs:366`).
6. **[High] –£—Å–∫–æ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ physics-pass** ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å `grid.swap` –Ω–∞ smart-–≤–µ—Ä—Å–∏—é, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã moves –∏ –Ω–µ –ø—Ä–æ–≤–æ—Ü–∏—Ä–æ–≤–∞—Ç—å overflow (`SandBox/packages/engine/src/physics.rs:393`, `SandBox/packages/engine/src/grid.rs:43`, `SandBox/packages/engine/src/grid.rs:534`).
7. **[High] MoveBuffer overflow = –Ω–µ ‚Äú–Ω–µ–≤–∏–¥–∏–º–∞—è –º–µ–ª–æ—á—å‚Äù** ‚Äî –ø—Ä–∏ overflow –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ safe-mode (dirty-all/–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç chunk occupancy), –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –æ—à–∏–±–∫—É, –∞ –Ω–µ ‚Äúok‚Äù.
8. **[High] –ü—Ä–∏–≤–µ—Å—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É friction/bounce –≤ –ø–æ—Ä—è–¥–æ–∫** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å generator –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏/–∑–Ω–∞—á–µ–Ω–∏—è –∏ engine-–ª–æ–≥–∏–∫—É (`SandBox/packages/engine/src/physics.rs:364`, `SandBox/scripts/generate-elements.js:43`).
9. **[High] RigidBodies: –ª–∏–±–æ —É–±—Ä–∞—Ç—å –∏–∑ UX, –ª–∏–±–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å** ‚Äî —Å–µ–π—á–∞—Å `SPAWN_RIGID_BODY` –¥–∞—ë—Ç –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –Ω–æ –¥–≤–∏–∂–æ–∫ no-op (`SandBox/packages/engine/src/rigid_body_system.rs:26`, `SandBox/apps/web/src/workers/simulation.worker.ts:1032`).
10. **[High] –£—Å—Ç—Ä–∞–Ω–∏—Ç—å ‚Äúdeadzone‚Äù –º–∞–ª—ã—Ö —Å–∫–æ—Ä–æ—Å—Ç–µ–π** ‚Äî —Å–µ–π—á–∞—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ < ~0.5 –∫–ª–µ—Ç–∫–∏/—à–∞–≥ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—é –∏–∑-–∑–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏; –¥–æ–±–∞–≤–∏—Ç—å fractional position (fixed-point) –∏–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–π —à–∞–≥.
11. **[Medium] –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä–æ–≥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏** (`0.01`/`0.1`) –∏ —Å–¥–µ–ª–∞—Ç—å –∏—Ö –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏.
12. **[Medium] –£–ª—É—á—à–∏—Ç—å DDA/raycast** ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ grid traversal (Amanatides & Woo) –≤–º–µ—Å—Ç–æ —Å–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å `round()` –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π.
13. **[Medium] –¢–µ—Å—Ç—ã —Ñ–∏–∑–∏–∫–∏** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å unit/property-—Ç–µ—Å—Ç—ã: ‚Äú—á–∞—Å—Ç–∏—Ü–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –∑–∞ step‚Äù, ‚Äúbounce –æ—Ç—Ä–∞–∂–∞–µ—Ç –∑–Ω–∞–∫‚Äù, ‚Äúclamp —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç‚Äù, ‚Äú–ø–∞–¥–µ–Ω–∏–µ –ø–µ—Å–∫–∞ —Å–∫–≤–æ–∑—å –≥–∞–∑/–≤ –≤–æ–¥—É –æ–∂–∏–¥–∞–µ–º–æ‚Äù.
14. **[Medium] rAF fallback –≤ worker** ‚Äî –µ—Å–ª–∏ —Ü–µ–ª–∏—Ç–µ—Å—å —à–∏—Ä–µ —á–µ–º Chrome/—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Chromium, –¥–æ–±–∞–≤—å—Ç–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—é –Ω–∞ —Ç–∞–π–º–µ—Ä.
15. **[Medium] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ –æ–ø–∏—Å–∞—Ç—å: –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Å—Å–æ–≤, –∫–æ–≥–¥–∞ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è `updated`, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç `dirty` (render vs simulation), –∏ –∫–∞–∫–∞—è —Ñ–∏–∑–∏–∫–∞ ‚Äú–∏—Å—Ç–∏–Ω–Ω–∞—è‚Äù (physics.rs vs behaviors/*).

---

## üõ† Refactoring Example

–°–∞–º–∞—è –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —á–∞—Å—Ç—å ‚Äî **physics-pass –±–µ–∑ `updated`**, –∏–∑-–∑–∞ —á–µ–≥–æ —á–∞—Å—Ç–∏—Ü–∞ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å 2+ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∑–∞ –æ–¥–∏–Ω —à–∞–≥ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏/–æ—Ç—Å–∫–æ–∫–∞—Ö).

**–ò–¥–µ–∞–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (—Å—É—Ç—å):**
1) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `grid.updated` –¥–ª—è physics-pass, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å ‚Äú—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –∞–ø–¥–µ–π—Ç –Ω–∞ —á–∞—Å—Ç–∏—Ü—É –∑–∞ step‚Äù.
2) –ü–æ—Å–ª–µ physics-pass —Å–±—Ä–æ—Å–∏—Ç—å `updated`, —á—Ç–æ–±—ã behavior-pass –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å–µ–π—á–∞—Å.

–ü—Ä–∏–º–µ—Ä (—É–ø—Ä–æ—â—ë–Ω–Ω–æ, –∏–¥–µ—è):

```rust
// world.rs (–∏–¥–µ—è)
pub fn step(&mut self) {
  self.grid.reset_updated();          // 1) updated = physics_updated
  self.process_physics_using_updated();
  self.grid.reset_updated();          // 2) updated = behavior_updated
  self.process_behaviors_only_dirty();
}

fn process_physics_using_updated(&mut self) {
  // ...
  for y in (start_y..end_y).rev() {
    for x in start_x..end_x {
      if self.grid.is_updated(x, y) { continue; }
      self.grid.set_updated(x, y, true);
      let res = update_particle_physics(&mut self.grid, &mut self.chunks, x, y, self.gravity_y);
      // swap –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç updated –≤–º–µ—Å—Ç–µ —Å —á–∞—Å—Ç–∏—Ü–µ–π ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ –±—É–¥–µ—Ç
      // ...
    }
  }
}
```

–ü–æ—á–µ–º—É –ª—É—á—à–µ:
- —É—Å—Ç—Ä–∞–Ω—è–µ—Ç double-processing (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å);
- —Å–Ω–∏–º–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥–∞ –ø–æ X/Y;
- –¥–µ–ª–∞–µ—Ç bounce/–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏–º–ø—É–ª—å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è ‚Äú–Ω–µ —Ä–∞–∑–æ–≥–Ω–∞—Ç—å‚Äù —á–∞—Å—Ç–∏—Ü—É –≤ –æ–¥–Ω–æ–º step.

